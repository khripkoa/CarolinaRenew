---
interface Props {
  location: any;
}

const { location } = Astro.props;

// Mock Reviews Data - In real app, this would come from a CMS or API
const allReviews = [
  {
    id: 1,
    author: "Sarah M.",
    city: "Charlotte",
    neighborhood: "SouthPark",
    rating: 5,
    text: "Carolina Renew transformed our kitchen cabinets! They look brand new. The team was professional and clean.",
    date: "2 weeks ago",
  },
  {
    id: 2,
    author: "James P.",
    city: "Rock Hill",
    rating: 5,
    text: "Excellent exterior painting job. They finished on time and the price was very fair. Highly recommend.",
    date: "1 month ago",
  },
  {
    id: 3,
    author: "Emily R.",
    city: "Fort Mill",
    neighborhood: "Baxter Village",
    rating: 5,
    text: "We hired them for interior painting in our new home in Baxter Village. Flawless work!",
    date: "3 weeks ago",
  },
  {
    id: 4,
    author: "Michael B.",
    city: "Charlotte",
    neighborhood: "University City",
    rating: 5,
    text: "Great experience from start to finish. The quote was detailed and accurate.",
    date: "2 months ago",
  },
];

// Filter reviews based on location
// 1. Try to find reviews from specific neighborhood
// 2. Fallback to City
// 3. Fallback to generic high-rated ones if not enough local ones

let localReviews = allReviews.filter((r) => r.city === location.city);

if (location.neighborhood) {
  const hoodReviews = localReviews.filter(
    (r) => r.neighborhood === location.neighborhood.name,
  );
  if (hoodReviews.length > 0) {
    // Prioritize neighborhood reviews
    localReviews = [
      ...hoodReviews,
      ...localReviews.filter(
        (r) => r.neighborhood !== location.neighborhood.name,
      ),
    ];
  }
}

// Limit to 3
const displayReviews = localReviews.slice(0, 3);
---

<section id="reviews" class="py-20 bg-gray-50">
  <div class="w-full px-4 sm:px-8 lg:px-12 xl:px-16">
    <div class="text-center mb-16">
      <h2 class="section-title-sm">
        Trusted by Homeowners in {location.city}
      </h2>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        We take pride in our work and our reputation. See what your neighbors
        are saying about their experience with Carolina Renew.
      </p>

      <div
        class="flex justify-center items-center mt-8 gap-3 bg-white inline-flex px-6 py-3 rounded-full shadow-sm border border-gray-100"
      >
        <div class="flex text-yellow-400">
          {
            [1, 2, 3, 4, 5].map(() => (
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
            ))
          }
        </div>
        <span class="text-gray-900 font-bold text-lg">5.0/5</span>
        <span class="text-gray-400">|</span>
        <span class="text-gray-600 font-medium"
          >Based on 150+ Reviews from different platforms</span
        >
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      {
        displayReviews.map((review, index) => (
          <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100 hover:shadow-xl transition duration-300 flex flex-col h-full">
            <div class="flex items-center justify-between mb-6">
              <div class="flex text-yellow-400">
                {[1, 2, 3, 4, 5].map(() => (
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                ))}
              </div>
              <span class="text-xs font-medium text-green-600 bg-green-50 px-2 py-1 rounded-full flex items-center gap-1">
                <svg
                  class="w-3 h-3"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  />
                </svg>
                Verified
              </span>
            </div>

            <p class="text-gray-700 mb-6 italic flex-grow leading-relaxed">
              "{review.text}"
            </p>

            <div class="flex items-center gap-4 pt-6 border-t border-gray-50">
              <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 font-bold text-sm">
                {review.author.charAt(0)}
              </div>
              <div>
                <p class="font-bold text-gray-900 text-sm">{review.author}</p>
                <p class="text-xs text-gray-500">
                  {review.neighborhood ? `${review.neighborhood}, ` : ""}
                  {review.city}
                </p>
              </div>
              <span class="ml-auto text-xs text-gray-400">{review.date}</span>
            </div>
          </div>
        ))
      }
    </div>

    <div class="mt-16 text-center">
      <a
        href="https://share.google/0FEmD5dN5hWuDKncR"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center justify-center px-8 py-4 border border-gray-300 shadow-sm text-base font-medium rounded-xl text-gray-700 bg-white hover:bg-gray-50 hover:text-gray-900 transition"
      >
        <svg
          class="w-5 h-5 mr-2 text-blue-500"
          viewBox="0 0 24 24"
          fill="currentColor"
          ><path
            d="M12.545,10.539c0-1.624,0.732-2.446,1.838-2.446c0.996,0,1.691,0.721,1.691,2.446c0,1.725-0.695,2.446-1.691,2.446 C13.277,12.985,12.545,12.163,12.545,10.539z M12.545,16.688c0-1.624,0.732-2.446,1.838-2.446c0.996,0,1.691,0.721,1.691,2.446 c0,1.725-0.695,2.446-1.691,2.446C13.277,19.134,12.545,18.312,12.545,16.688z M7.891,10.539c0-1.624,0.732-2.446,1.838-2.446 c0.996,0,1.691,0.721,1.691,2.446c0,1.725-0.695,2.446-1.691,2.446C8.623,12.985,7.891,12.163,7.891,10.539z M7.891,16.688 c0-1.624,0.732-2.446,1.838-2.446c0.996,0,1.691,0.721,1.691,2.446c0,1.725-0.695,2.446-1.691,2.446 C8.623,19.134,7.891,18.312,7.891,16.688z M24,12c0,6.627-5.373,12-12,12S0,18.627,0,12S5.373,0,12,0S24,5.373,24,12z M13.596,4.938 c-2.574,0-3.229,1.74-3.229,1.74h-0.033c0,0-0.654-1.74-3.229-1.74C4.982,4.938,4.164,6.41,4.164,9.666 c0,3.256,0.818,4.728,2.941,4.728c2.574,0,3.229-1.74,3.229-1.74h0.033c0,0,0.654,1.74,3.229,1.74c2.123,0,2.941-1.472,2.941-4.728 C16.537,6.41,15.719,4.938,13.596,4.938z M13.596,11.087c-2.574,0-3.229,1.74-3.229,1.74h-0.033c0,0-0.654-1.74-3.229-1.74 c-2.123,0-2.941,1.472-2.941,4.728c0,3.256,0.818,4.728,2.941,4.728c2.574,0,3.229-1.74,3.229-1.74h0.033c0,0,0.654,1.74,3.229,1.74 c2.123,0,2.941-1.472,2.941-4.728C16.537,12.559,15.719,11.087,13.596,11.087z"
          ></path></svg
        >
        Read more reviews on Google
      </a>
    </div>
  </div>
</section>
