---
import Layout from '../layouts/Layout.astro';
// ИМПОРТ: Импортируем централизованный список городов из localAreas.js
// (Предполагая, что locations.astro находится в src/pages/)
import { cityLocations } from '../data/localAreas.js';

// Проверяем, что cityLocations существует, и создаем копию,
// чтобы избежать ошибки, если массив undefined
const rawCities = cityLocations ? [...cityLocations] : [];

// 1. Фильтруем города, исключая те, которые перенаправляют (Charlotte)
const filteredCities = rawCities.filter(city => !city.redirect);

// 2. Сортируем города по названию (city_display)
const sortedCities = filteredCities.sort((a, b) =>
    a.city_display.localeCompare(b.city_display)
);

// 3. Группируем города по штатам (NC, SC)
const groupedLocations = sortedCities.reduce((acc, city) => {
    const state = city.state_abbr;
    if (!acc[state]) {
        acc[state] = [];
    }
    acc[state].push(city);
    return acc;
}, {});

const title = "Our Service Areas & Locations | Carolina Renew";
const description = "We proudly serve communities across North Carolina (NC) and South Carolina (SC) for all your painting and remodeling needs.";
---

<Layout title={title} description={description} currentLocation="All Locations">
    <section class="py-20 md:py-24 bg-white">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold text-blue-900">
                    Our Service Areas
                </h1>
                <p class="mt-4 text-xl text-gray-600">
                    We cover the entire Charlotte Metro area, including parts of North and South Carolina.
                </p>
            </div>

            <div class="max-w-4xl mx-auto">
                {Object.keys(groupedLocations).sort().map((state) => (
                    <div class="mb-10 p-6 border border-gray-200 rounded-lg bg-gray-50">
                        <h2 class="text-3xl font-bold text-blue-800 mb-6 border-b pb-2">
                            {state === 'NC' ? 'North Carolina' : 'South Carolina'} ({state})
                        </h2>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                            {groupedLocations[state].map((city) => (
                                <a
                                    href={`/local/${city.city_slug}`}
                                    class="text-lg text-gray-700 hover:text-blue-600 font-medium"
                                >
                                    {city.city_display} →
                                </a>
                            ))}
                        </div>
                    </div>
                ))}
            </div>

        </div>
    </section>
</Layout>
