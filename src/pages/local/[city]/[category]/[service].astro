---
import Layout from '../../../../layouts/Layout.astro';
import { cityLocations, serviceCategories, allServices, getCityData } from '../../../../data/localAreas.js';

// --- getStaticPaths: Генерируем все возможные тройки Город/Категория/Услуга ---
export async function getStaticPaths() {
    const paths = [];

    // Проходим по всем городам
    cityLocations.forEach(cityData => {
        if (!cityData.redirect) {
            // Проходим по всем категориям
            serviceCategories.forEach(categoryData => {
                allServices
                    .filter(s => s.category_slug === categoryData.category_slug)
                    .forEach(serviceData => {
                        paths.push({
                            params: {
                                city: cityData.city_slug,
                                category: categoryData.category_slug,
                                service: serviceData.service_slug
                            },
                            props: {
                                citySlug: cityData.city_slug,
                                serviceSlug: serviceData.service_slug
                            }
                        });
                    });
            });
        }
    });

    return paths;
}

const { city, category, service } = Astro.params;
const { citySlug, serviceSlug } = Astro.props;

const cityData = getCityData(citySlug);
const serviceData = allServices.find(s => s.service_slug === serviceSlug);

// Защита: если данные не найдены
if (!cityData || !serviceData) {
    return new Response('404 Not Found', { status: 404 });
}

const CapitalizedCity = cityData.city_display;
const state = cityData.state_abbr;
const CapitalizedService = serviceData.service_display;

const pageTitle = `${CapitalizedService} Services in ${CapitalizedCity}, ${state} | Carolina Renew`;
const description = `Detailed information about ${CapitalizedService} services, pricing, and project examples in ${CapitalizedCity}, ${state}.`;
---

<Layout title={pageTitle} description={description}>
    <section class="bg-white py-20 text-center">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl md:text-5xl font-bold text-blue-900 mb-4">
                Detailed Information: {CapitalizedService} in {CapitalizedCity}, {state}
            </h1>
            <p class="text-xl text-gray-700">
                This is the final landing page. Full process description, gallery, testimonials, and a quote form will be here.
            </p>
            <a href={`/local/${city}/${category}`} class="mt-8 inline-block text-blue-600 hover:underline">
                ← Back to {category.charAt(0).toUpperCase() + category.slice(1)} Services
            </a>
        </div>
    </section>
</Layout>
