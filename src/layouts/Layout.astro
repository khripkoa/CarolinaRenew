---
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import GeoBlock from '@/components/GeoBlock.astro';
// Импортируем CSS-файл для стилизации (чтобы не было мигания)
import '../styles/global.css';
// Импортируем функцию для поиска по ключу
import { getLocalAreaByKey } from '@/data/localAreas.js';


const {
  title = 'Carolina Renew | Painting & Remodeling',
  description = 'Carolina Renew provides quality interior and exterior painting, kitchen and bathroom remodeling in Charlotte and surrounding areas. Free estimates, quality guarantee.',
  keywords = 'painting, remodeling, Charlotte, North Carolina, painters, renovation, interior, exterior, kitchen, bathroom',
  canonicalUrl,
  // Дефолтное значение остается, но будет переопределено
  currentLocation = 'Charlotte',
} = Astro.props;


// --- ЛОГИКА ОПРЕДЕЛЕНИЯ АКТУАЛЬНОЙ ЛОКАЦИИ (Финальная версия) ---
let activeLocation = currentLocation;

// 1. Проверяем, есть ли динамический параметр "key" в роуте (для страниц типа /local/gastonia)
if (Astro.params.key) {
  const loc = getLocalAreaByKey(Astro.params.key);
  if (loc) {
    activeLocation = loc.name;
  }
}
// 2. Если нет динамического параметра, но есть пропс currentLocation, используем его
else if (currentLocation) {
    activeLocation = currentLocation;
}
// ---------------------------------

// Формируем полный заголовок для SEO
const finalTitle = title.includes('Carolina Renew') ? title : `${title} | Carolina Renew`;
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />

    <title>{finalTitle}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    {canonicalUrl && <link rel="canonical" href={canonicalUrl} />}

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
  </head>
  <body class="bg-white text-gray-800">

    {/* !!! ПЕРЕДАЕМ АКТУАЛЬНУЮ ЛОКАЦИЮ !!! */}
    <Header currentLocation={activeLocation} />

    <main>
      <slot />
    </main>

    <GeoBlock />

    <Footer />

  </body>
</html>
